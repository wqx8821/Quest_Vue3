{"version":3,"file":"reactivity.global.js","sources":["../src/effect.ts","../../shared/index.ts","../src/reactive.ts"],"sourcesContent":["\r\nexport function effect() {\r\n  \r\n}","export function isObject (value: unknown) : value is Record<any, any> {\r\n  return value instanceof Object && value !== null\r\n}","// 引入判断是否为对象的 方法\r\nimport {isObject} from '@vue/shared'\r\n\r\n// 用来标识是否已经是响应式的\r\nconst enum ReactiveFlags {\r\n  IS_REACTIVE = \"__v_isReactive\"\r\n}\r\n\r\n// 抽离proxy代理内部参数\r\nconst mutableHandles:ProxyHandler<Record<any, any>> = {\r\n  // 1.操作的对象 2.具体的属性 3.代理本身\r\n  get(target, key, receiver) {\r\n    if(key === ReactiveFlags.IS_REACTIVE) {\r\n      return true;\r\n    }\r\n\r\n    // 读取时，就可以收集在那个Reflect中\r\n    const res = Reflect.get(target, key, receiver)\r\n    return res;\r\n  },\r\n  // 1.操作的对象 2.操作的属性 3.修改为的值 4.代理本身\r\n  set(target, key, value, receiver) {\r\n    // 修改值就可以驱动进行更新\r\n\r\n    const res = Reflect.set(target, key, value, receiver) // 给目标对象属性key赋值 值为value\r\n    return res;\r\n  }\r\n}\r\n\r\n// 映射表 处理已经是响应式的数据，是响应式的就可以直接返回\r\nconst reactiveMap = new WeakMap(); // WeakMap 弱引用，键必须为key，key没有被引用会自动回收\r\n\r\n\r\n\r\n// 工厂函数\r\nfunction createReactiveObject(target: object){\r\n  // reactive只针对对象\r\n  if(!isObject(target)) {\r\n    return target\r\n  }\r\n  // 判断是否已经代理过，代理过就直接返回\r\n  if((target as any)[ReactiveFlags.IS_REACTIVE]) {\r\n    return target;\r\n  }\r\n\r\n\r\n  // 如果已经存在代理 就直接返回这个代理\r\n  const existingProxy = reactiveMap.get(target)\r\n  if(existingProxy) {\r\n    return existingProxy\r\n  }\r\n\r\n  // 是对象就进行proxy代理 进行数据劫持\r\n  const proxy = new Proxy(target,mutableHandles)\r\n  // 源对象与代理对象创建出映射表\r\n  reactiveMap.set(target, proxy)\r\n\r\n\r\n  // 返回代理\r\n  return proxy\r\n}\r\n\r\n// 导出 reactive\r\nexport function reactive(target:object) {\r\n  return createReactiveObject(target)\r\n}"],"names":[],"mappings":";;;WACgB,MAAM,GAAA;EAEtB;;ECHM,SAAU,QAAQ,CAAE,KAAc,EAAA;EACtC,IAAA,OAAO,KAAK,YAAY,MAAM,IAAI,KAAK,KAAK,IAAI,CAAA;EAClD;;ECFA;EAQA;EACA,MAAM,cAAc,GAAkC;;EAEpD,IAAA,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAA;UACvB,IAAG,GAAG,yCAAgC;EACpC,YAAA,OAAO,IAAI,CAAC;EACb,SAAA;;EAGD,QAAA,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;EAC9C,QAAA,OAAO,GAAG,CAAC;OACZ;;EAED,IAAA,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAA;;EAG9B,QAAA,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAA;EACrD,QAAA,OAAO,GAAG,CAAC;OACZ;GACF,CAAA;EAED;EACA,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;EAIlC;EACA,SAAS,oBAAoB,CAAC,MAAc,EAAA;;EAE1C,IAAA,IAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;EACpB,QAAA,OAAO,MAAM,CAAA;EACd,KAAA;;MAED,IAAI,MAAc,oCAA2B,EAAE;EAC7C,QAAA,OAAO,MAAM,CAAC;EACf,KAAA;;MAID,MAAM,aAAa,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;EAC7C,IAAA,IAAG,aAAa,EAAE;EAChB,QAAA,OAAO,aAAa,CAAA;EACrB,KAAA;;MAGD,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAC,cAAc,CAAC,CAAA;;EAE9C,IAAA,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;;EAI9B,IAAA,OAAO,KAAK,CAAA;EACd,CAAC;EAED;EACM,SAAU,QAAQ,CAAC,MAAa,EAAA;EACpC,IAAA,OAAO,oBAAoB,CAAC,MAAM,CAAC,CAAA;EACrC;;;;;;;;;;;;;"}